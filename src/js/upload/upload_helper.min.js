!function(){function e(e,t){return e<1024?e+" "+t:e<1048576?Math.round(e/1024)+" K"+t:Math.round(e/1024/1024*100)/100+" M"+t}var t=document.createElement("canvas");if(!(FileReader&&File&&document.querySelector&&FormData&&XMLHttpRequest&&JSON&&t.toBlob))return!1;window.uploadHelper=function(t,r){function n(){if(0==c.length)return!1;var e=c.shift(),t=new FileReader;t.file=e,t.onloadend=function(){if(this.error)return!1;t.file.hash=u.digest(t.result),delete t,n()},t.readAsArrayBuffer(e)}function a(){if(0==f.length)return!1;var t=f.shift();p=f.length,r.resize&&t.type.match(/^image\/jpe?g/)&&!t.noUpload?(w.removeAttribute("max"),w.removeAttribute("value"),s(t,r.width,r.height,function(n){if(n.size>g){this.value="";var a={name:t.name,size:e(n.size,r.bytes),max_size:e(g,r.bytes)},i=r.size_error_msg.replace(/%([a-z_]+)/g,function(e,t){return a[t]});return o(),!alert(i)}h(t,n)})):h(t,!1)}function h(e,r){var n=new XMLHttpRequest,i=new FormData(d);if(e.noUpload?(i.append("uploadHelper_mode","hash_only"),i.append("uploadHelper_fileName",e.name)):r?(i.append("uploadHelper_mode","upload"),i.append(t.getAttribute("name"),r,e.name)):(i.append("uploadHelper_mode","upload"),i.append(t.getAttribute("name"),e)),e.hash&&i.append("uploadHelper_fileHash",e.hash),i.append("uploadHelper_status",p),n.onprogress=function(e){w.max=e.total,e.lengthComputable?(w.value=e.loaded,w.innerHTML=Math.round(e.loaded/e.total)+"%"):w.innerHTML=e.loaded},n.onreadystatechange=function(){if(4==n.readyState){if(200==n.status){try{e=window.JSON.parse(n.responseText)}catch(t){e={error:"Server replied with invalid JSON ("+t.message+"): "+n.responseText}}try{if(e.callback&&window[e.callback](e))return!1;if(e.redirect)return location.href=e.redirect,!1;if(e.next)return a(),!1}catch(t){e={error:"Server error: "+t.message}}}else var e={error:"Server response error. HTTP code: "+n.status};alert(e.error),o(),delete n}},n.open("POST",d.action,!0),n.send(i),delete i,f.length+1==t.files.length)for(var h=d.elements,s=0;s<h.length;s++)"hidden"!=h[s].type&&(h[s].disabled=!0)}function o(){for(var e=d.elements,t=0;t<e.length;t++)"hidden"!=e[t].type&&(e[t].disabled=!1,e[t].readOnly=!1);p="error",w.parentNode.parentNode.removeChild(w.parentNode),f=!1}function s(e,t,r,n){var a=new Image;a.src=(window.URL||window.webkitURL).createObjectURL(e),a.onload=function(){var e=t,i=r;if(null==r&&t<0){var h=Math.abs(t)*Math.abs(t),o=a.width*a.height;if(o>h){var s=Math.sqrt(o)/Math.abs(t);i=Math.round(a.height/s),e=Math.round(a.width/s)}else e=a.width,i=a.height;e>10*Math.abs(t)?(e=10*Math.abs(t),i=Math.round(a.height*e/a.width)):i>10*Math.abs(t)&&(i=10*Math.abs(t),e=Math.round(a.width*i/a.height))}else null==r&&(a.width>a.height?i=Math.round(a.height*t/a.width):a.width==a.height?i=t:(i=t,e=Math.round(a.width*i/a.height)),a.width<e&&a.height<i&&(e=a.width,i=a.height));e=Math.abs(e),i=Math.abs(i);var u=!1;(e<a.width||i<a.height)&&((u=document.createElement("canvas")).width=2*e,u.height=2*i,u.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,2*e,2*i));var d=document.createElement("canvas");d.width=e,d.height=i,d.getContext("2d").drawImage(u||a,0,0,(u||a).width,(u||a).height,0,0,e,i),delete u,d.toBlob(n,"image/jpeg",.85),(window.URL||window.webkitURL).revokeObjectURL(a.src),delete a,delete d}}var u=new Rusha,d=t.form,l=t.hasAttribute("data-hash-check"),f=!1,c=!1,p=!1,w=!1;(r=r||{}).width=r.width||!1,r.height=r.height||null,r.resize=!(!r.width||!r.resize),r.bytes=r.bytes||"B",r.size_error_msg=r.size_error_msg||"The file %file has a size of %size, more than the allowed %max_size allowed.";g=null;if(i=d.querySelector("input[name=MAX_FILE_SIZE]"))var g=i.value;t.addEventListener("change",function(){var t=this.files;if(c=[],t.length<1)return!1;if(!this.multiple&&t.length>1)return this.value="",!1;for(var a=t.length,i=0;i<a;i++){var h=t[i];if(h.size>g&&(!r.resize||!h.type.match(/^image\/jpe?g/))){this.value="";var o={name:h.name,size:e(h.size,r.bytes),max_size:e(g,r.bytes)},s=r.size_error_msg.replace(/%([a-z_]+)/g,function(e,t){return o[t]});return!alert(s)}c.push(h)}n()},!1),d.addEventListener("submit",function(e){if(!t.files||0==t.files.length)return!0;if(e.preventDefault(),!1!==f)return!1;if(0==f.length)return!0;f=Object.keys(t.files).map(function(e){return t.files[e]}),t.disabled=!0;for(var r=d.elements,n=0;n<r.length;n++)"hidden"!=r[n].type&&(r[n].readOnly=!0);var i=document.createElement("div");if(i.className="uploadHelper_progress",w=document.createElement("progress"),i.appendChild(w),t.parentNode.insertBefore(i,t.nextSibling),l){for(var h=new XMLHttpRequest,o=new FormData,s=0,n=0;n<f.length;n++)f[n].hash&&(o.append("uploadHelper_hashCheck[]",f[n].hash),s++);if(s>0)return h.onreadystatechange=function(){if(4==h.readyState){if(200==h.status){var e=h.responseText;e=window.JSON.parse(e),f=f.filter(function(t){return!t.hash||(t.hash in e&&(t.noUpload=!0),!0)})}a()}},h.open("POST",d.action,!0),h.send(o),!1}return a(),!1},!1)},function(){function e(t){"use strict";for(var r={fill:0},n=function(e){for(e+=9;e%64>0;e+=1);return e},a=function(e,t){var r=new Uint8Array(e.buffer),n=t%4,a=t-n;switch(n){case 0:r[a+3]=0;case 1:r[a+2]=0;case 2:r[a+1]=0;case 3:r[a+0]=0}for(var i=1+(t>>2);i<e.length;i++)e[i]=0},i=function(e,t,r){e[t>>2]|=128<<24-(t%4<<3),e[14+(2+(t>>2)&-16)]=r/(1<<29)|0,e[15+(2+(t>>2)&-16)]=r<<3},h=function(e,t,r,n,a){var i,h=this,o=a%4,s=(n+o)%4,u=n-s;switch(o){case 0:e[a]=h[r+3];case 1:e[a+1-(o<<1)|0]=h[r+2];case 2:e[a+2-(o<<1)|0]=h[r+1];case 3:e[a+3-(o<<1)|0]=h[r]}if(!(n<s+o)){for(i=4-o;i<u;i=i+4|0)t[a+i>>2|0]=h[r+i]<<24|h[r+i+1]<<16|h[r+i+2]<<8|h[r+i+3];switch(s){case 3:e[a+u+1|0]=h[r+u+2];case 2:e[a+u+2|0]=h[r+u+1];case 1:e[a+u+3|0]=h[r+u]}}},o=function(e){return h.bind(new Uint8Array(e))},s=new Array(256),u=0;u<256;u++)s[u]=(u<16?"0":"")+u.toString(16);var d=function(e){for(var t=new Uint8Array(e),r=new Array(e.byteLength),n=0;n<r.length;n++)r[n]=s[t[n]];return r.join("")},l=function(e){var t;if(e<=65536)return 65536;if(e<16777216)for(t=1;t<e;t<<=1);else for(t=16777216;t<e;t+=16777216);return t};!function(t){if(t%64>0)throw new Error("Chunk size must be a multiple of 128 bit");r.offset=0,r.maxChunkLen=t,r.padMaxChunkLen=n(t),r.heap=new ArrayBuffer(l(r.padMaxChunkLen+320+20)),r.h32=new Int32Array(r.heap),r.h8=new Int8Array(r.heap),r.core=new e._core({Int32Array:Int32Array,DataView:DataView},{},r.heap),r.buffer=null}(t||65536);var f=function(e,t){r.offset=0;var n=new Int32Array(e,t+320,5);n[0]=1732584193,n[1]=-271733879,n[2]=-1732584194,n[3]=271733878,n[4]=-1009589776},c=function(e,t){var h=n(e),o=new Int32Array(r.heap,0,h>>2);return a(o,e),i(o,e,t),h},p=function(e,t,n,a){o(e)(r.h8,r.h32,t,n,a||0)},w=function(e,t,n,a,i){var h=n;p(e,t,n),i&&(h=c(n,a)),r.core.hash(h,r.padMaxChunkLen)},g=function(e,t){var r=new Int32Array(e,t+320,5),n=new Int32Array(5),a=new DataView(n.buffer);return a.setInt32(0,r[0],!1),a.setInt32(4,r[1],!1),a.setInt32(8,r[2],!1),a.setInt32(12,r[3],!1),a.setInt32(16,r[4],!1),n},m=this.rawDigest=function(e){var t=e.byteLength||e.length||e.size||0;f(r.heap,r.padMaxChunkLen);var n=0,a=r.maxChunkLen;for(n=0;t>n+a;n+=a)w(e,n,a,t,!1);return w(e,n,t-n,t,!0),g(r.heap,r.padMaxChunkLen)};this.digest=function(e){return d(m(e).buffer)};var v=this.rawEnd=function(){var e=r.offset,t=e%r.maxChunkLen,n=c(t,e);r.core.hash(n,r.padMaxChunkLen);var a=g(r.heap,r.padMaxChunkLen);return f(r.heap,r.padMaxChunkLen),a};this.end=function(){return d(v().buffer)}}e._core=function(e,t,r){"use asm";var n=new e.Int32Array(r);function a(e,t){e=e|0;t=t|0;var r=0,a=0,i=0,h=0,o=0,s=0,u=0,d=0,l=0,f=0,c=0,p=0,w=0,g=0;i=n[t+320>>2]|0;o=n[t+324>>2]|0;u=n[t+328>>2]|0;l=n[t+332>>2]|0;c=n[t+336>>2]|0;for(r=0;(r|0)<(e|0);r=r+64|0){h=i;s=o;d=u;f=l;p=c;for(a=0;(a|0)<64;a=a+4|0){g=n[r+a>>2]|0;w=((i<<5|i>>>27)+(o&u|~o&l)|0)+((g+c|0)+1518500249|0)|0;c=l;l=u;u=o<<30|o>>>2;o=i;i=w;n[e+a>>2]=g}for(a=e+64|0;(a|0)<(e+80|0);a=a+4|0){g=(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])<<1|(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])>>>31;w=((i<<5|i>>>27)+(o&u|~o&l)|0)+((g+c|0)+1518500249|0)|0;c=l;l=u;u=o<<30|o>>>2;o=i;i=w;n[a>>2]=g}for(a=e+80|0;(a|0)<(e+160|0);a=a+4|0){g=(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])<<1|(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])>>>31;w=((i<<5|i>>>27)+(o^u^l)|0)+((g+c|0)+1859775393|0)|0;c=l;l=u;u=o<<30|o>>>2;o=i;i=w;n[a>>2]=g}for(a=e+160|0;(a|0)<(e+240|0);a=a+4|0){g=(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])<<1|(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])>>>31;w=((i<<5|i>>>27)+(o&u|o&l|u&l)|0)+((g+c|0)-1894007588|0)|0;c=l;l=u;u=o<<30|o>>>2;o=i;i=w;n[a>>2]=g}for(a=e+240|0;(a|0)<(e+320|0);a=a+4|0){g=(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])<<1|(n[a-12>>2]^n[a-32>>2]^n[a-56>>2]^n[a-64>>2])>>>31;w=((i<<5|i>>>27)+(o^u^l)|0)+((g+c|0)-899497514|0)|0;c=l;l=u;u=o<<30|o>>>2;o=i;i=w;n[a>>2]=g}i=i+h|0;o=o+s|0;u=u+d|0;l=l+f|0;c=c+p|0}n[t+320>>2]=i;n[t+324>>2]=o;n[t+328>>2]=u;n[t+332>>2]=l;n[t+336>>2]=c}return{hash:a}},window.Rusha=e}()}();