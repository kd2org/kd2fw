!function(){var e=document.createElement("canvas"),x=window.URL||window.webkitURL;if(!(FileReader&&File&&document.querySelector&&FormData&&XMLHttpRequest&&JSON&&e.toBlob&&DataView&&x&&Promise))return;delete e;var a={resize:/image\/jpeg/,max_file_size:null,max_width:800,jpeg_quality:.87,thumb_upload:/image\/(jpeg|png|gif|svg+xml)/,thumb_max_width:300,thumb_jpeg_quality:.8,bytes:"B",size_error_msg:"The file %file has a size of %size, more than the allowed %max_size allowed.",edit_name_field:!1};function L(e,t){return e<1024?e+" "+t:e<1048576?Math.round(e/1024)+" K"+t:Math.round(e/1024/1024*100)/100+" M"+t}window.uploadHelper=function(e,s){var i=new Rusha,u=e.querySelector("input[type=file]");u.required=!1;var d=u.form,f=[],c=!1,o=!1,h=[],p=!1,m=!1;s=s||{};for(var t in a)t in s||(s[t]=a[t]);null===s.max_file_size&&(t=d.querySelector("input[name=MAX_FILE_SIZE]"))&&(s.max_file_size=parseInt(t.value,10)),e.classList.toggle("uploadHelper");var g=document.createElement("table");function l(e){f.push(e);var t=document.createElement("tr"),a=document.createElement("td");a.className="preview",function(a,n){if(a.type.match(/^image\/(jpe?g|gif|svg\+xml|png)$/))h.push([a,s.thumb_width,s.thumb_height,"image/png",9,function(e){a.url=x.createObjectURL(e);var t=new Image;t.src=a.url,n.appendChild(t),v()}]);else{var e=a.type.replace(/^(\w+)\/.*$/g,"type_$1");e+=" type_"+a.type.replace(/[^\w]+/g,"_");var t=document.createElement("span");t.className=e,t.innerHTML=a.name.replace(/^.*\./,""),n.appendChild(t)}}(e,a);var n=document.createElement("th"),r=document.createElement("input");r.type="text",r.value=e.name.replace(/\.\w+$/,""),r.disabled=!s.edit_name_field,n.appendChild(r);var i=document.createElement("td"),o=document.createElement("input");o.type="button",o.value="ðŸ—™",o.title="Delete",o.onclick=w,i.appendChild(o),t.appendChild(a),t.appendChild(n),t.appendChild(i),g.appendChild(t)}function w(e){var t=e.target.parentNode.parentNode,a=t.rowIndex;f.splice(a,1),t.className="deleted",window.setTimeout(function(){t.parentNode.removeChild(t)},750)}function v(){var e=h.shift();e&&n.apply(this,e)}function _(){if(0==c.length)return!1;var o=c.shift();p=c.length;var h=f.length-1-c.length;if(s.resize&&o.type.match(/^image\/jpe?g/)&&!o.noUpload){var l=g.rows[h];l.className="resizing",m.removeAttribute("max"),m.removeAttribute("value"),n(o,s.width,s.height,"image/jpeg",s.jpeg_quality,function(t){if(t.size>max_size){this.value="";var a={name:o.name,size:L(t.size,s.bytes),max_size:L(max_size,s.bytes)},e=s.size_error_msg.replace(/%([a-z_]+)/g,function(e,t){return a[t]});return b(),!alert(e)}var n=function(e){y(o,h,t,e)};if(s.upload_thumb){var r=l.querySelector("img"),i=document.createElement("canvas");i.width=r.width,i.height=r.height,i.getContext("2d").drawImage(r,0,0),i.toBlob(n,"image/jpeg",s.thumb_quality)}else n(!1)})}else y(o,h,!1)}function y(e,t,a,n){var r=new XMLHttpRequest,i=new FormData(d),o=g.rows[t];if(o.className="uploading",s.edit_name_field&&(e.alias=o.querySelector("input[type=text]").value),e.noUpload?(i.append("uploadHelper_mode","hash_only"),i.append("uploadHelper_fileName",e.name)):a?(i.append("uploadHelper_mode","upload"),i.append(u.getAttribute("name"),a,e.alias||e.name)):(i.append("uploadHelper_mode","upload"),i.append(u.getAttribute("name"),e)),n&&i.append("uploadHelper_thumbnail",n,e.alias||e.name),e.hash&&i.append("uploadHelper_fileHash",e.hash),i.append("uploadHelper_status",p),r.onprogress=function(e){m.max=e.total,e.lengthComputable?(m.value=e.loaded,m.innerHTML=Math.round(e.loaded/e.total)+"%"):m.innerHTML=e.loaded},r.onreadystatechange=function(){if(4==r.readyState){if(200==r.status){o.className="uploaded";try{var t=window.JSON.parse(r.responseText)}catch(e){t={error:"Server replied with invalid JSON ("+e.message+"): "+r.responseText}}try{if(t.callback&&window[t.callback](t))return!1;if(t.redirect)return location.href=t.redirect,!1;if(t.next)return _(),!1}catch(e){t={error:"Server error: "+e.message}}}else t={error:"Server response error. HTTP code: "+r.status};alert(t.error),b(),delete r}},r.open("POST",d.action,!0),r.send(i),delete i,c.length+1==f.length)for(var h=d.elements,l=0;l<h.length;l++)"hidden"!=h[l].type&&(h[l].disabled=!0)}function b(){for(var e=d.elements,t=0;t<e.length;t++)"hidden"!=e[t].type&&(e[t].disabled=!1,e[t].readOnly=!1);p="error",m.parentNode.parentNode.removeChild(m.parentNode),c=!1}function n(t,i,o,h,l,s,u){if(null===u)return e=t,d=function(e){return n(t,i,o,h,l,s,e)},(a=new FileReader).onload=function(e){var t=new DataView(e.target.result);if(65496!=t.getUint16(0,!1))return d(-2);for(var a=t.byteLength,n=2;n<a;){var r=t.getUint16(n,!1);if(n+=2,65505==r){if(1165519206!=t.getUint32(n+=2,!1))return d(-1);var i=18761==t.getUint16(n+=6,!1);n+=t.getUint32(n+4,i);var o=t.getUint16(n,i);n+=2;for(var h=0;h<o;h++)if(274==t.getUint16(n+12*h,i))return d(t.getUint16(n+12*h+8,i))}else{if(65280!=(65280&r))break;n+=t.getUint16(n,!1)}}return d(-1)},void a.readAsArrayBuffer(e);var e,d,a;o=o||i;var f=new Image;f.src=(window.URL||window.webkitURL).createObjectURL(t),f.onload=function(){f.width,f.height;if(u&&u<=8){var e=document.createElement("canvas");switch(-1<[5,6,7,8].indexOf(u)?(e.width=f.height,e.height=f.width):(e.width=f.width,e.height=f.height),(n=e.getContext("2d")).imageSmoothingQuality="high",u){case 2:n.transform(-1,0,0,1,f.width,0);break;case 3:n.transform(-1,0,0,-1,f.width,f.height);break;case 4:n.transform(1,0,0,-1,0,f.height);break;case 5:n.transform(0,1,1,0,0,0);break;case 6:n.transform(0,1,-1,0,f.height,0);break;case 7:n.transform(0,-1,-1,0,f.height,f.width);break;case 8:n.transform(0,-1,1,0,0,f.width);break;default:n.transform(1,0,0,1,0,0)}n.drawImage(f,0,0),(window.URL||window.webkitURL).revokeObjectURL(f.src),f.width=1,f.height=1,delete f,f=e}var t=i,a=o;in_ratio=f.width/f.height,out_ratio=i/o,in_ratio>=out_ratio?a=i/in_ratio:t=o*in_ratio,t=Math.abs(t),a=Math.abs(a);var n,r=1;((n=(e=document.createElement("canvas")).getContext("2d")).imageSmoothingQuality="high",(t<f.width||a<f.height)&&(r=2),e.width=t*r,e.height=a*r,n.drawImage(f,0,0,f.width,f.height,0,0,t*r,a*r),f instanceof Image&&((window.URL||window.webkitURL).revokeObjectURL(f.src),f.width=1,f.height=1),delete f,1<r)&&(f=e,(n=(e=document.createElement("canvas")).getContext("2d")).imageSmoothingQuality="high",e.width=t,e.height=a,n.drawImage(f,0,0,f.width,f.height,0,0,t,a),delete f);e.toBlob(s,h,l),delete e}}e.appendChild(g),u.addEventListener("change",function(){if(o=[],this.files.length<1)return!1;if(!this.multiple&&1<this.files.length)return this.value="",!1;for(var e=this.files.length,t=0;t<e;t++){var a=this.files[t];if(a.size>s.max_file_size&&!a.type.match(s.resize)){this.value="";var n={name:a.name,size:L(a.size,s.bytes),max_size:L(max_size,s.bytes)},r=s.size_error_msg.replace(/%([a-z_]+)/g,function(e,t){return n[t]});return!alert(r)}o.push(a),l(a)}this.value="",v(),function e(){if(0==o.length)return!1;var t=o.shift();var a=new FileReader;a.file=t;a.onloadend=function(){if(this.error)return!1;a.file.hash=i.digest(a.result),delete a,e()};a.readAsArrayBuffer(t)}()},!1),d.addEventListener("submit",function(e){if(0==f.length)return!0;if(e.preventDefault(),!1!==c)return!1;if(0==c.length)return!0;c=f,u.disabled=!0;for(var t=d.elements,a=0;a<t.length;a++)"hidden"!=t[a].type&&(t[a].readOnly=!0);var n=document.createElement("div");if(n.className="uploadHelper_progress",m=document.createElement("progress"),n.appendChild(m),u.parentNode.insertBefore(n,u.nextSibling),s.check_hash){var r=new XMLHttpRequest,i=new FormData,o=0;for(a=0;a<c.length;a++)c[a].hash&&(i.append("uploadHelper_hashCheck[]",c[a].hash),o++);if(0<o)return r.onreadystatechange=function(){if(4==r.readyState){if(200==r.status){var t=r.responseText;t=window.JSON.parse(t),c=c.filter(function(e){return e.hash&&e.hash in t&&(e.noUpload=!0),!0})}_()}},r.open("POST",d.action,!0),r.send(i),!1}return _(),!1},!1)},function(){function c(e){"use strict";for(var h={fill:0},l=function(e){for(e+=9;0<e%64;e+=1);return e},r=new Array(256),t=0;t<256;t++)r[t]=(t<16?"0":"")+t.toString(16);var a=function(e){for(var t=new Uint8Array(e),a=new Array(e.byteLength),n=0;n<a.length;n++)a[n]=r[t[n]];return a.join("")};!function(e){if(0<e%64)throw new Error("Chunk size must be a multiple of 128 bit");h.offset=0,h.maxChunkLen=e,h.padMaxChunkLen=l(e),h.heap=new ArrayBuffer(function(e){var t;if(e<=65536)return 65536;if(e<16777216)for(t=1;t<e;t<<=1);else for(t=16777216;t<e;t+=16777216);return t}(h.padMaxChunkLen+320+20)),h.h32=new Int32Array(h.heap),h.h8=new Int8Array(h.heap),h.core=new c._core({Int32Array:Int32Array,DataView:DataView},{},h.heap),h.buffer=null}(e||65536);var i=function(e,t){h.offset=0;var a=new Int32Array(e,t+320,5);a[0]=1732584193,a[1]=-271733879,a[2]=-1732584194,a[3]=271733878,a[4]=-1009589776},o=function(e,t){var a,n,r,i=l(e),o=new Int32Array(h.heap,0,i>>2);return function(e,t){var a=new Uint8Array(e.buffer),n=t%4,r=t-n;switch(n){case 0:a[r+3]=0;case 1:a[r+2]=0;case 2:a[r+1]=0;case 3:a[r+0]=0}for(var i=1+(t>>2);i<e.length;i++)e[i]=0}(o,e),r=t,(a=o)[(n=e)>>2]|=128<<24-(n%4<<3),a[14+(2+(n>>2)&-16)]=r/(1<<29)|0,a[15+(2+(n>>2)&-16)]=r<<3,i},s=function(e,t,a,n){(function(e,t,a,n,r){var i,o=this,h=r%4,l=(n+h)%4,s=n-l;switch(h){case 0:e[r]=o[a+3];case 1:e[r+1-(h<<1)|0]=o[a+2];case 2:e[r+2-(h<<1)|0]=o[a+1];case 3:e[r+3-(h<<1)|0]=o[a]}if(!(n<l+h)){for(i=4-h;i<s;i=i+4|0)t[r+i>>2|0]=o[a+i]<<24|o[a+i+1]<<16|o[a+i+2]<<8|o[a+i+3];switch(l){case 3:e[r+s+1|0]=o[a+s+2];case 2:e[r+s+2|0]=o[a+s+1];case 1:e[r+s+3|0]=o[a+s]}}}).bind(new Uint8Array(e))(h.h8,h.h32,t,a,n||0)},u=function(e,t,a,n,r){var i=a;s(e,t,a),r&&(i=o(a,n)),h.core.hash(i,h.padMaxChunkLen)},d=function(e,t){var a=new Int32Array(e,t+320,5),n=new Int32Array(5),r=new DataView(n.buffer);return r.setInt32(0,a[0],!1),r.setInt32(4,a[1],!1),r.setInt32(8,a[2],!1),r.setInt32(12,a[3],!1),r.setInt32(16,a[4],!1),n},n=this.rawDigest=function(e){var t=e.byteLength||e.length||e.size||0;i(h.heap,h.padMaxChunkLen);var a=0,n=h.maxChunkLen;for(a=0;a+n<t;a+=n)u(e,a,n,t,!1);return u(e,a,t-a,t,!0),d(h.heap,h.padMaxChunkLen)};this.digest=function(e){return a(n(e).buffer)};var f=this.rawEnd=function(){var e=h.offset,t=e%h.maxChunkLen,a=o(t,e);h.core.hash(a,h.padMaxChunkLen);var n=d(h.heap,h.padMaxChunkLen);return i(h.heap,h.padMaxChunkLen),n};this.end=function(){return a(f().buffer)}}c._core=function(e,t,a){"use asm";var g=new e.Int32Array(a);function n(e,t){e=e|0;t=t|0;var a=0,n=0,r=0,i=0,o=0,h=0,l=0,s=0,u=0,d=0,f=0,c=0,p=0,m=0;r=g[t+320>>2]|0;o=g[t+324>>2]|0;l=g[t+328>>2]|0;u=g[t+332>>2]|0;f=g[t+336>>2]|0;for(a=0;(a|0)<(e|0);a=a+64|0){i=r;h=o;s=l;d=u;c=f;for(n=0;(n|0)<64;n=n+4|0){m=g[a+n>>2]|0;p=((r<<5|r>>>27)+(o&l|~o&u)|0)+((m+f|0)+1518500249|0)|0;f=u;u=l;l=o<<30|o>>>2;o=r;r=p;g[e+n>>2]=m}for(n=e+64|0;(n|0)<(e+80|0);n=n+4|0){m=(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])<<1|(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])>>>31;p=((r<<5|r>>>27)+(o&l|~o&u)|0)+((m+f|0)+1518500249|0)|0;f=u;u=l;l=o<<30|o>>>2;o=r;r=p;g[n>>2]=m}for(n=e+80|0;(n|0)<(e+160|0);n=n+4|0){m=(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])<<1|(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])>>>31;p=((r<<5|r>>>27)+(o^l^u)|0)+((m+f|0)+1859775393|0)|0;f=u;u=l;l=o<<30|o>>>2;o=r;r=p;g[n>>2]=m}for(n=e+160|0;(n|0)<(e+240|0);n=n+4|0){m=(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])<<1|(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])>>>31;p=((r<<5|r>>>27)+(o&l|o&u|l&u)|0)+((m+f|0)-1894007588|0)|0;f=u;u=l;l=o<<30|o>>>2;o=r;r=p;g[n>>2]=m}for(n=e+240|0;(n|0)<(e+320|0);n=n+4|0){m=(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])<<1|(g[n-12>>2]^g[n-32>>2]^g[n-56>>2]^g[n-64>>2])>>>31;p=((r<<5|r>>>27)+(o^l^u)|0)+((m+f|0)-899497514|0)|0;f=u;u=l;l=o<<30|o>>>2;o=r;r=p;g[n>>2]=m}r=r+i|0;o=o+h|0;l=l+s|0;u=u+d|0;f=f+c|0}g[t+320>>2]=r;g[t+324>>2]=o;g[t+328>>2]=l;g[t+332>>2]=u;g[t+336>>2]=f}return{hash:n}},window.Rusha=c}()}();
