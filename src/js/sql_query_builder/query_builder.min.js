!function(){function e(e){this.columns=e}(window.SQLQueryBuilder=e).prototype.loadDefaultOperators=function(){for(var e in this.operators={"= ?":this.__("is equal to"),"!= ?":this.__("is not equal to"),"IN (??)":this.__("is equal to one of"),"NOT IN (??)":this.__("is not equal to one of"),"> ?":this.__("is greater than"),">= ?":this.__("is greater than or equal to"),"< ?":this.__("is less than"),"<= ?":this.__("is less than or equal to"),"BETWEEN ? AND ?":this.__("is between"),"NOT BETWEEN ? AND ?":this.__("is not between"),"IS NULL":this.__("is null"),"IS NOT NULL":this.__("is not null"),"LIKE ?%":this.__("begins with"),"NOT LIKE ?%":this.__("doesn't begin with"),"LIKE %?":this.__("ends with"),"NOT LIKE %?":this.__("doesn't end with"),"LIKE %?%":this.__("contains"),"NOT LIKE %?%":this.__("doesn't contain"),"&":this.__("matches one of"),"= 1":this.__("is true"),"= 0":this.__("is false")},this.types_operators={integer:["= ?","!= ?","IN (??)","NOT IN (??)","> ?",">= ?","< ?","<= ?","BETWEEN ? AND ?","NOT BETWEEN ? AND ?"],enum:["= ?","!= ?","IN (??)","NOT IN (??)"],boolean:["= 1","= 0"],text:["= ?","!= ?","IN (??)","NOT IN (??)","LIKE ?%","NOT LIKE ?%","LIKE %?","NOT LIKE %?","LIKE %?%","NOT LIKE %?%"],bitwise:["&"]},this.types_operators){var t,i={};for(t in this.types_operators[e]){var o=this.types_operators[e][t];i[o]=this.operators[o]}this.types_operators[e]=i}this.types_operators.date=JSON.parse(JSON.stringify(this.types_operators.integer)),delete this.types_operators.date["<= ?"],delete this.types_operators.date[">= ?"],this.types_operators.date["< ?"]=this.__("before"),this.types_operators.date["> ?"]=this.__("after"),this.types_operators.datetime=this.types_operators.date},e.prototype.__=function(e){return e},e.prototype.init=function(e){this.parent=e;var t={"":"---"};for(column in this.columns)t[column]=this.columns[column].label;this.columnSelect=this.buildSelect(t)},e.prototype.addGroup=function(t,e){var i=document.createElement("fieldset"),o=document.createElement("legend"),n=this.buildSelect({AND:this.__("Matches ALL of the following conditions:"),OR:this.__("Matches ANY of the following conditions:"),ADD:this.__("Add a new set of conditions below this one"),DEL:this.__("Remove this set of conditions")});n.onfocus=function(){this.oldValue=this.value},n.value=e;var s=this;n.onchange=function(){var e;"DEL"==this.value?1!=t.childNodes.length?t.removeChild(i):this.value=this.oldValue:"ADD"==this.value&&(e=s.addGroup(t,"AND"),s.addRow(e),this.value=this.oldValue)},o.appendChild(n),i.appendChild(o);o=document.createElement("table");return i.appendChild(o),t.appendChild(i),i},e.prototype.addRow=function(e,t){var i=e.getElementsByTagName("table")[0],o=document.createElement("tr"),n=document.createElement("td");n.className="buttons";var s=this,e=this.buildInput("button","+");e.onclick=function(){s.addRow(function(e,t){for(;(e=e.parentElement)&&!(e.matches||e.matchesSelector).call(e,t););return e}(this,"fieldset"),this.parentNode.parentNode)},n.appendChild(e),(e=this.buildInput("button","-")).onclick=function(){s.deleteRow(this.parentNode.parentNode)},n.appendChild(e),o.appendChild(n),(n=document.createElement("td")).className="column";e=this.columnSelect.cloneNode(!0);return e.onchange=function(){return s.switchColumn(this)},n.appendChild(e),o.appendChild(n),(n=document.createElement("td")).className="operator",o.appendChild(n),(n=document.createElement("td")).className="values",o.appendChild(n),void 0===t?i.appendChild(o):i.insertBefore(o,t.nextSibling),o},e.prototype.deleteRow=function(e){e.parentNode.childNodes.length<=1||e.parentNode.removeChild(e)},e.prototype.switchColumn=function(e){var t=e.parentNode.parentNode;t.childNodes[2].innerHTML="",e.value&&((e=this.addOperator(t,this.columns[e.value])).value=e.children[1].value,this.switchOperator(e,null))},e.prototype.addOperator=function(e,t){var i,o=this.types_operators[t.type],n={"":"---"};for(i in t.null&&(o["IS NULL"]=this.operators["IS NULL"],o["IS NOT NULL"]=this.operators["IS NOT NULL"]),o)n[i]=o[i];var t=this.buildSelect(n),s=this;return t.onchange=function(){return s.switchOperator(this)},e.childNodes[2].appendChild(t),t},e.prototype.switchOperator=function(e,t){var i=e.parentNode.parentNode;!t&&i.childNodes[3].firstChild&&(t=[i.childNodes[3].firstChild.value]),i.childNodes[3].innerHTML="";var o=i.childNodes[3],i=i.childNodes[1].firstChild,n=e.value,s=this.columns[i.value];if(n){var r=1,e=!1,l=null,i=n.match(/\?/g);if(i&&n.match(/\?\?/))r=t?t.length:1,e=!0;else if(i&&1<=i.length)r=i.length;else{if("bitwise"!=s.type||"&"!=n)return;r=1}for(var a,d=0;d<r;d++)if(l=this.addMatchField(o,l,s,n),"bitwise"==s.type&&t)for(var h=0;h<s.values.length;h++)o.querySelectorAll("input")[h].checked=-1!=t.indexOf(h.toString());else t&&(l.value=t[d]);e&&((e=this.buildInput("button","-")).onclick=function(){this.parentNode.childNodes.length<=3||(this.parentNode.removeChild(this.previousSibling),this.parentNode.removeChild(this.previousSibling))},o.appendChild(e),e=this.buildInput("button","+"),a=this,e.onclick=function(){a.addMatchField(o,this.previousSibling.previousSibling,s,n)},o.appendChild(e))}},e.prototype.addMatchField=function(e,t,i,o){if("enum"==i.type)var n=this.buildSelect(i.values);else if("bitwise"==i.type){var s,n=document.createElement("span");for(s in i.values){var r=this.buildInput("checkbox",s),l=document.createElement("label");l.appendChild(r),l.appendChild(document.createTextNode(" "+i.values[s])),n.appendChild(l.cloneNode(!0))}}else n=this.buildInput(i.type,"",i);return n=e.insertBefore(n,t?t.nextSibling:null),t&&e.insertBefore(document.createElement("br"),n),n},e.prototype.buildInput=function(e,t,i){var o=document.createElement("input");return o.type="integer"==e?"number":e,o.value=t,o},e.prototype.buildSelect=function(e){var t,i=document.createElement("select");for(t in e){var o=document.createElement("option");o.value=t,o.innerHTML=e[t],i.appendChild(o)}return i},e.prototype.import=function(e){for(var t in e)if(0!=e[t].conditions.length){var i,o=this.addGroup(this.parent,e[t].operator);for(i in e[t].conditions){var n=e[t].conditions[i],s=this.addRow(o);s.childNodes[1].firstChild.value=n.column;s=this.addOperator(s,this.columns[n.column]);s.value=n.operator,this.switchOperator(s,n.values)}}},e.prototype.export=function(){var e,t=this.parent.querySelectorAll("table"),i=[];for(e in t)if(t.hasOwnProperty(e)){for(var o=(e=t[e]).rows,n=[],s=0;s<o.length;s++){var r,l=o[s];l.getElementsByTagName("select")[0].value&&(r=(r=Array.prototype.slice.call(l.cells[3].querySelectorAll("input, select")).map(function(e){return"checkbox"==e.type?e.checked?e.value:null:"button"!=e.type?e.value:void 0})).filter(function(e){return null!==e}),(r={column:l.cells[1].firstChild.value,operator:l.cells[2].firstChild.value,values:r}).operator&&n.push(r))}i.push({operator:e.parentNode.firstChild.firstChild.value,conditions:n})}return i}}();