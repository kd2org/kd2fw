window.textEditor=function(t){if(!document.getElementById(t))throw new Error("Invalid ID parameter: "+t);return this.id=t,this.textarea=document.getElementById(t),this.shortcuts=[],this.supportsExecCommand=null,"selectionStart"in this.textarea&&(this.textarea.addEventListener("keydown",this.keyEvent.bind(this),!0),this.textarea.addEventListener("keypress",this.keyEvent.bind(this),!0),!0)},textEditor.prototype.keyEvent=function(t){var e,t=t||window.event;for(e in this.shortcuts){var r=this.shortcuts[e];if(!t.metaKey&&(!(t.ctrlKey&&!r.ctrl||r.ctrl&&!t.ctrlKey)&&!(t.shiftKey&&!r.shift||r.shift&&!t.shiftKey)&&!(t.altKey&&!r.alt||r.alt&&!t.altKey)&&(e=this.matchKeyPress(r.key,t)))){if("function"==typeof r.callback)return!r.callback.call(this,t,e)||this.preventDefault(t);var n=(r.ctrl?"Ctrl-":"")+(r.alt?"Alt-":"");throw n+=(r.shift?"Shift-":"")+r,new Error("Invalid callback type for shortcut "+n)}}return!0},textEditor.prototype.matchKeyPress=function(t,e){return!(e.defaultPrevented||!e.key)&&(t=t.toLowerCase(),e.key.toLowerCase()==t&&t)},textEditor.prototype.preventDefault=function(t){return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),t.returnValue=!1,!(t.cancelBubble=!0)},textEditor.prototype.getSelection=function(){var t=this.textarea,e=t.selectionEnd-t.selectionStart;return{start:t.selectionStart,end:t.selectionEnd,length:e,text:t.value.substr(t.selectionStart,e)}},textEditor.prototype.replaceSelection=function(t,e){var r=t.start,n=r+e.length;return this.setSelection(r,t.end),this.insert(e),this.setSelection(r,n),{start:r,end:n,length:e.length,text:e}},textEditor.prototype.insert=function(t){var e;return!0===this.supportsExecCommand?document.execCommand("insertText",!1,t):null===this.supportsExecCommand&&(e=this.textarea.value,document.execCommand("insertText",!1,t),this.supportsExecCommand=e!==this.textarea.value),!1===this.supportsExecCommand&&this.textarea.setRangeText(t,this.textarea.selectionStart,this.textarea.selectionEnd,"end"),this.supportsExecCommand},textEditor.prototype.insertAtPosition=function(t,e,r){var n=t+e.length,t=this.getSelection();return this.setSelection(t.start,t.end),this.insert(e),r=r||n,this.setSelection(r,r)},textEditor.prototype.setSelection=function(t,e){var r=this.textarea;return r.focus(),r.selectionStart=t,r.selectionEnd=e,this.getSelection()},textEditor.prototype.scrollToSelection=function(t){var e=this.textarea,r=e.value.substr(t.end);e.value=e.value.substr(0,t.end),e.scrollTop=1e5;var n=e.scrollTop;e.value+=r,e.scrollTop=n,this.setSelection(t.start,t.end)},textEditor.prototype.wrapSelection=function(t,e,r){var n=this.textarea,o=n.scrollTop,s=t.text,t=this.replaceSelection(t,e+s+r);return""==s&&(t=this.setSelection(t.start+e.length,t.start+e.length)),n.scrollTop=o,t};